name: Test RA-EE Action with Yarn
on: [page_build]

jobs:
  ra_enterprise_action_workflow:
    runs-on: ubuntu-latest
    name: Yarn v${{matrix.version}} - Add React Admin Enterprise Edition CI token
    strategy:
      matrix:
        version: ["1.22.21", "2.4.3", "3.6.4", "4.0.0"]
    steps:
      # To use this repository's private action,
      # you must check out the repository
      - name: Checkout
        uses: actions/checkout@v2
      - name: Token file creation
        uses: ./
        # Replace with the following line to test outside of this repository
        # uses: react-admin/ra-enterprise-action@1.0.0
        env:
          RA_EE_CI_TOKEN: ${{secrets.RA_EE_CI_TOKEN}}
      - run: yarn set version ${{matrix.version}}
      - run: yarn -v
      - run: yarn install
        env:
          # The following is necessary to allow yarn to use a different version
          # than the one included in the base image
          YARN_ENABLE_IMMUTABLE_INSTALLS: false
